{% extends "base.html" %}

{% block scripture %}
<script type="text/javascript">
$(document).ready(function() {
	var targetOffset = $("#member_data").offset().top;
	$("html").animate({scrollTop: targetOffset}, 500);

	$("#id_subject").focus();
});

var toggleDiv = function(div, a) {
	if ($(div).css("display") == "none") {
		$(div).show(300, function() {
			body_msg_id = $(this).attr("id");
			msg_id = body_msg_id.split('_')[1];
			subj_msg_id = "#subj_" + msg_id;
			star_span = $(subj_msg_id).find("span.msg_is_new");
			if (star_span.text()) {
				$.ajax({
					type: 'POST',
					url: '{% url mark_msg_read %}',
					data: "h={{ request.true_id }}&m=" + msg_id,
					dataType: 'json',
					success: function(retData) {
						if (retData['status'] == 'OK') {
							star_span.text('');
						}
					}
				});
			}
		});
		$(a).text("Piilota");
	} else {
		$(div).hide(300);
		$(a).text("N채yt채");
	}
}

var toggleReply = function(div, a) {
	if ($(div).css("display") == "none") {
		$(div).show(300);
	} else {
		$(div).hide(300);
		$(a).text("Vastaa");
	}
}
</script>
{% endblock %}

{% block content %}
	<div id="member_data" class="member_data">
	{% include "tags/member_pic.html" %}
	</div>

<div class="messages">
	<div id="msg_container" style="display: block;">
	{% for msg in inbox_messages %}
		<div id="subj_{{ msg.id }}" style="margin-top: 1em;">
			<span class="msg_is_new">
			{% if not msg.read_at %}
			*
			{% endif %}
			</span>
			<span class="msg_subject">{{ msg.subject }}</span> <a style="cursor: pointer;" onClick="toggleDiv('#body_{{ msg.id }}', this);">N채yt채</a>
			<br />
			<div id="body_{{ msg.id }}" style="display: none;">
				{{ msg.body_html|safe }}
				<a style="cursor: pointer;" onClick="toggleReply('#reply_to_{{ msg.id }}', this);">Vastaa</a>
				<div id="reply_to_{{ msg.id }}" style="display: none;">
				nii
				</div>
			</div>
			<span class="msg_user">{{ msg.sender }}</span>
			<span class="msg_date">{{ msg.sent_at }}</span>
		</div>
	{% endfor %}
	</div>
</div>

{% endblock %}

